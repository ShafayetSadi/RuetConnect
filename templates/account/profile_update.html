{% extends "base.html" %}
{% load widget_tweaks %}

{% block main %}
<div class="container mx-auto px-4">
    <h1 class="mb-8 text-center text-3xl font-bold">Update Profile</h1>

    <div class="grid gap-8 lg:grid-cols-2">
        <!-- Left Column: User Info & Profile Info -->
        <div class="space-y-8">
            <!-- User Information Form -->
            <div class="card bg-base-200 border-base-300 border shadow-xl">
                <div class="card-body">
                    <h3 class="card-title mb-4 text-xl">User Information</h3>
                    <form method="POST" class="space-y-4">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="user_info">

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">First Name</span>
                                </label>
                                {{ user_form.first_name }}
                                {% if user_form.first_name.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Last Name</span>
                                </label>
                                {{ user_form.last_name }}
                                {% if user_form.last_name.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Username</span>
                                </label>
                                {{ user_form.username }}
                                {% if user_form.username.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.username.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Email</span>
                                </label>
                                {{ user_form.email }}
                                {% if user_form.email.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Student/Employee ID</span>
                                </label>
                                {{ user_form.student_id }}
                                {% if user_form.student_id.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.student_id.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">User Type</span>
                                </label>
                                {{ user_form.user_type }}
                                {% if user_form.user_type.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.user_type.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Department</span>
                                </label>
                                {{ user_form.department }}
                                {% if user_form.department.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.department.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Series</span>
                                </label>
                                {{ user_form.series }}
                                {% if user_form.series.errors %}
                                <div class="text-error text-sm mt-1">{{ user_form.series.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="card-actions justify-end pt-4">
                            <button type="submit" class="btn btn-primary">Update User Info</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Profile Information Form -->
            <div class="card bg-base-200 border-base-300 border shadow-xl">
                <div class="card-body">
                    <h3 class="card-title mb-4 text-xl">Profile Information</h3>
                    <form method="POST" class="space-y-4">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="profile_info">

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Phone</span>
                                </label>
                                {{ profile_form.phone }}
                                {% if profile_form.phone.errors %}
                                <div class="text-error text-sm mt-1">{{ profile_form.phone.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Birth Date</span>
                                </label>
                                {{ profile_form.birth_date }}
                                {% if profile_form.birth_date.errors %}
                                <div class="text-error text-sm mt-1">{{ profile_form.birth_date.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Address</span>
                            </label>
                            {{ profile_form.address }}
                            {% if profile_form.address.errors %}
                            <div class="text-error text-sm mt-1">{{ profile_form.address.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Bio</span>
                            </label>
                            {{ profile_form.bio }}
                            {% if profile_form.bio.errors %}
                            <div class="text-error text-sm mt-1">{{ profile_form.bio.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Facebook URL</span>
                                </label>
                                {{ profile_form.facebook_url }}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">LinkedIn URL</span>
                                </label>
                                {{ profile_form.linkedin_url }}
                            </div>
                        </div>

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">GitHub URL</span>
                                </label>
                                {{ profile_form.github_url }}
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Twitter URL</span>
                                </label>
                                {{ profile_form.twitter_url }}
                            </div>
                        </div>

                        <div class="grid gap-4 md:grid-cols-2">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Interests</span>
                                </label>
                                {{ profile_form.interests_text }}
                                <div class="label">
                                    <span class="label-text-alt">Separate with commas</span>
                                </div>
                            </div>

                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">Skills</span>
                                </label>
                                {{ profile_form.skills_text }}
                                <div class="label">
                                    <span class="label-text-alt">Separate with commas</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <label class="label cursor-pointer">
                                <span class="label-text mr-2">Show Email</span>
                                {{ profile_form.show_email }}
                            </label>

                            <label class="label cursor-pointer">
                                <span class="label-text mr-2">Show Phone</span>
                                {{ profile_form.show_phone }}
                            </label>
                        </div>

                        <div class="card-actions justify-end pt-4">
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Column: Avatar & Password -->
        <div class="space-y-8">
            <!-- Avatar Update Form -->
            <div class="card bg-base-200 border-base-300 border shadow-xl">
                <div class="card-body">
                    <h3 class="card-title mb-4 text-xl">Profile Picture</h3>
                    <form method="POST" enctype="multipart/form-data" class="space-y-4">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="avatar_update">

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Current Avatar</span>
                            </label>
                            <div class="avatar mb-4">
                                <div
                                    class="ring-primary ring-offset-base-100 h-24 w-24 rounded-full ring ring-offset-2">
                                    {% if user.profile.avatar %}
                                    <img src="{{ user.profile.avatar.url }}" alt="profile picture" />
                                    {% else %}
                                    <div
                                        class="bg-primary text-primary-content flex h-full w-full items-center justify-center rounded-full text-2xl font-bold">
                                        {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Upload New Avatar</span>
                            </label>
                            {{ avatar_form.avatar }}
                            {% if avatar_form.avatar.errors %}
                            <div class="text-error text-sm mt-1">{{ avatar_form.avatar.errors.0 }}</div>
                            {% endif %}
                            <div class="label">
                                <span class="label-text-alt">Maximum size: 5MB. Supported formats: JPG, PNG, GIF</span>
                            </div>
                        </div>

                        <div class="card-actions justify-end pt-4">
                            <button type="submit" class="btn btn-primary">Update Avatar</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Password Change Form -->
            <div class="card bg-base-200 border-base-300 border shadow-xl">
                <div class="card-body">
                    <h3 class="card-title mb-4 text-xl">Change Password</h3>
                    <form method="POST" class="space-y-4">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="password_change">

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Current Password</span>
                            </label>
                            {{ password_form.current_password }}
                            {% if password_form.current_password.errors %}
                            <div class="text-error text-sm mt-1">{{ password_form.current_password.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">New Password</span>
                            </label>
                            {{ password_form.new_password1 }}
                            {% if password_form.new_password1.errors %}
                            <div class="text-error text-sm mt-1">{{ password_form.new_password1.errors.0 }}</div>
                            {% endif %}
                            <div class="label">
                                <span class="label-text-alt">Password must be at least 8 characters long</span>
                            </div>
                        </div>

                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Confirm New Password</span>
                            </label>
                            {{ password_form.new_password2 }}
                            {% if password_form.new_password2.errors %}
                            <div class="text-error text-sm mt-1">{{ password_form.new_password2.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="card-actions justify-end pt-4">
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to Profile Button -->
    <div class="mt-8 text-center">
        <a href="{% url 'profile' %}" class="btn btn-ghost">Back to Profile</a>
    </div>
</div>
{% endblock main %}

{% block right_side_bar %}
{% endblock right_side_bar %}